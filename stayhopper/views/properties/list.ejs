<%-include('../shared/header.ejs',{active:'properties',parent:'hotels-management'})%>
<div class="content-inner">
    <!-- Page Header-->
    <header class="page-header">
        <div class="container-fluid d-flex justify-content-between align-items-center">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="/properties">Hotel Management</a>
                    </li>
                    <li class="breadcrumb-item active fw-700" aria-current="page">Properties</li>
                </ol>
            </nav>
            <div class="header-buttons d-flex">
                <form action="" id="filterForm" class="d-flex">
                    <a href="/properties/new"><button type="button" class="btn btn-primary mr-md-4"><i class="fa fa-plus-circle"></i> Add New</button></a>
                </form>
            </div>
        </div>
    </header>

    <div class="container-fluid">
        <%  properties.forEach((property)=>{ %>
        <div class="row wrapper property-list justify-content-center align-items-center mt-4 bg-white has-shadow">
            <div class="col-lg-12 col-md-12 col-sm-12 col-12 property-list-items d-flex justify-content-around flex-column flex-md-row flex-nowrap">
                <dl>
                    <dt>Property Name</dt>
                    <dd>
                        <%=property.name%>
                    </dd>
                </dl>
                <dl>
                    <dt>Contact person</dt>
                    <dd>
                        <%=property.contactinfo.contact_person%>
                    </dd>
                </dl>
                <dl>
                    <dt>Property Type</dt>
                    <dd>
                        <%
                         if(typeof(property.type)!="undefined" && property.type){
                             %>
                                <%=property.type.name%>
                             <%
                         }
                        %>
                    </dd>
                </dl>
                <dl>
                    <dt>Number of Rooms</dt>
                    <dd>
                        <%=property.total_rooms%> Rooms</dd>
                </dl>
                <dl class="d-flex align-items-center">
                    <a href="/properties/view/<%=property._id%>"><button type="button" class="btn btn-secondary btn-square">View</button></a>
                </dl>
                <dl class="d-flex align-items-center">
                    <!-- <a href="/properties/delete/<%=property._id%>"  -->
                    <a id="show-panel" onclick="return checkActiveBookings('<%=property._id%>')">
                        <i class="icon sh-icon-delete font-lg"></i>
                    </a>
                    <a href="/properties/edit/<%=property._id%>" id="show-panel">
                        <i class="icon sh-icon-edit font-lg"></i>
                    </a>
                </dl>
            </div>
        </div>
        <% });%>
        <%- include('../shared/pagination') %>
    </div>
    <script type="text/javascript">
        $('select[name="company"]').on('change', function () {
            $('form#filterForm').submit();
        })
        function checkActiveBookings(property_id) {
            if (confirm('Are you sure?')) {
                $.ajax({
                    url: '/properties/check_active_bookings',
                    type: 'post',
                    dataType: 'json',
                    data: { property_id: property_id },
                    async: false,
                    success: function (data) {
                        if (data.count > 0) {
                            alert("has active bookings");
                        } else {
                            window.location.href = "/properties/delete/" + property_id
                        }
                    }
                });
            }
        }
    </script>
    <%-include('../shared/footer.ejs')%>